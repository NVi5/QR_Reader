/*
 * Empty C++ Application
 */
#include "xaxidma.h"
#include "xparameters.h"
#include "xil_exception.h"
#include <string.h>
#include "../include/tinyprintf.h"

#define TEXT_BASE				XPAR_TEXTBLOCK_0_S00_AXI_BASEADDR
#define TEXT_XPOS				(*(uint32_t*)(TEXT_BASE + 0))
#define TEXT_YPOS				(*(uint32_t*)(TEXT_BASE + 4))
#define TEXT_COLOR				(*(uint32_t*)(TEXT_BASE + 8))
#define TEXT_SCALE				(*(uint32_t*)(TEXT_BASE + 12))

__attribute__((section(".text_buffer")))
static char text[16*16];

static XAxiDma text_dma;
static XAxiDma_Config *text_dma_config;

int main()
{

	text_dma_config = XAxiDma_LookupConfig(XPAR_AXIDMA_0_DEVICE_ID);
	XAxiDma_CfgInitialize(&text_dma, text_dma_config);
	sprintf(text, "Testasd3");

	XAxiDma_SimpleTransfer(
			&text_dma,
			(UINTPTR)text,
			16*16,
			XAXIDMA_DMA_TO_DEVICE
		);
	TEXT_XPOS = 640;
	TEXT_YPOS = 360;
	TEXT_COLOR = 0xFF0000;
	TEXT_SCALE = 1;
	while(1);
	return 0;
}
